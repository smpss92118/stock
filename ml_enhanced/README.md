# ML-Enhanced Trading System

## ğŸ¯ ç³»çµ±æ¦‚è¿°

é€™æ˜¯åŸºæ–¼åŸå§‹äº¤æ˜“ç³»çµ±çš„ ML å¢å¼·ç‰ˆæœ¬ï¼Œæ—¨åœ¨é€šéæ©Ÿå™¨å­¸ç¿’æ¨¡å‹éæ¿¾åŸå§‹è¨Šè™Ÿï¼Œæé«˜å‹ç‡ä¸¦é™ä½é¢¨éšªã€‚

**æ ¸å¿ƒç†å¿µ**:
1. **åŸå§‹æƒæ**: ä½¿ç”¨å‚³çµ±æŠ€è¡“åˆ†æ (HTF, CUP, VCP) æ‰¾å‡ºæ‰€æœ‰æ½›åœ¨æ©Ÿæœƒã€‚
2. **ML éæ¿¾**: ä½¿ç”¨ XGBoost æ¨¡å‹é æ¸¬æ¯å€‹è¨Šè™Ÿçš„å‹ç‡ï¼Œåªä¿ç•™é«˜å“è³ªè¨Šè™Ÿã€‚

---

## ğŸ“‚ ç›®éŒ„çµæ§‹ (Production)

```
ml_enhanced/
â”œâ”€â”€ daily_ml_scanner.py    # [æ ¸å¿ƒ] æ¯æ—¥ ML æƒæå™¨ (Crontab 19:05)
â”œâ”€â”€ weekly_retrain.py      # [æ ¸å¿ƒ] æ¯é€±æ¨¡å‹å†è¨“ç·´ (Crontab Sun 02:00)
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ prepare_ml_data.py # ç‰¹å¾µå·¥ç¨‹ (ä½¿ç”¨ src.ml.features)
â”‚   â”œâ”€â”€ train_models.py    # æ¨¡å‹è¨“ç·´ (XGBoost)
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ stock_selector.pkl # è‚¡ç¥¨é¸æ“‡æ¨¡å‹ (XGBoost Classifier)
â”‚   â””â”€â”€ feature_info.pkl   # ç‰¹å¾µå…ƒæ•¸æ“š
â”œâ”€â”€ daily_reports/         # æ¯æ—¥ç”Ÿæˆçš„ ML å ±å‘Š
â”‚   â””â”€â”€ YYYY-MM-DD/
â”‚       â”œâ”€â”€ ml_daily_summary.md
â”‚       â””â”€â”€ ml_signals.csv
â”œâ”€â”€ data/                  # è¨“ç·´æ•¸æ“š
â”‚   â””â”€â”€ ml_features.csv
â”œâ”€â”€ README.md              # æœ¬æ–‡ä»¶
â””â”€â”€ CRONTAB_SETUP.md       # è‡ªå‹•åŒ–è¨­å®šèªªæ˜
```

> **æ³¨æ„**: æœ¬ç³»çµ±ä¾è³´ `stock/src/ml/` (ç‰¹å¾µæå–) å’Œ `stock/src/utils/` (æ—¥èªŒè¨˜éŒ„) å…±äº«æ¨¡çµ„ã€‚

---

## ğŸš€ æ ¸å¿ƒçµ„ä»¶

### 1. æ¯æ—¥æƒæ (`daily_ml_scanner.py`)
- **åŠŸèƒ½**: åŸ·è¡Œæ¯æ—¥æƒæï¼Œä¸¦æ‡‰ç”¨ ML æ¨¡å‹éæ¿¾ã€‚
- **è¼¸å…¥**: æ¯æ—¥è‚¡åƒ¹æ•¸æ“š
- **è¼¸å‡º**: `ml_daily_summary.md` (åŒ…å« ML æ¨è–¦è¨Šè™Ÿèˆ‡åŸå§‹è¨Šè™Ÿå°æ¯”)
- **é‚è¼¯**:
    1. åŸ·è¡ŒåŸå§‹æƒæ (HTF/CUP/VCP)
    2. è¼‰å…¥ ML æ¨¡å‹ (`stock_selector.pkl`)
    3. ç‚ºæ¯å€‹è¨Šè™Ÿè¨ˆç®— ML ç‰¹å¾µ
    4. é æ¸¬å‹ç‡ (Probability)
    5. ç”Ÿæˆå ±å‘Š (æ¨è–¦ Prob â‰¥ 0.4 çš„è¨Šè™Ÿ)

### 2. æ¯é€±å†è¨“ç·´ (`weekly_retrain.py`)
- **åŠŸèƒ½**: æ¯é€±ä½¿ç”¨æœ€æ–°æ•¸æ“šé‡æ–°è¨“ç·´æ¨¡å‹ï¼Œç¢ºä¿æ¨¡å‹é©æ‡‰å¸‚å ´è®ŠåŒ–ã€‚
- **æµç¨‹**:
    1. **æº–å‚™æ•¸æ“š**: åŸ·è¡Œ `prepare_ml_data.py`ï¼Œé‡æ–°è¨ˆç®—æ‰€æœ‰æ­·å²ç‰¹å¾µã€‚
    2. **è¨“ç·´æ¨¡å‹**: åŸ·è¡Œ `train_models.py`ï¼Œä½¿ç”¨ TimeSeriesSplit é©—è­‰ä¸¦è¨“ç·´æ–°æ¨¡å‹ã€‚
    3. **æ›´æ–°æ¨¡å‹**: è¦†è“‹èˆŠçš„ `models/stock_selector.pkl`ã€‚

---

## ğŸ¤– ML æ¨¡å‹èªªæ˜

### Stock Selector (è‚¡ç¥¨é¸æ“‡æ¨¡å‹)

- **ç®—æ³•**: XGBoost Classifier
- **ç›®æ¨™**: é æ¸¬è¨Šè™Ÿæ˜¯å¦ç‚º "Winner" (æœªä¾† 20 å¤©æ¼²å¹… > 10%)
- **ç‰¹å¾µ (10 Features)**:
    - **å‹æ…‹å“è³ª**: `pattern_quality` (A/B/C), `distance_to_buy`
    - **æŠ€è¡“æŒ‡æ¨™**: `rsi_14`, `ma_trend`, `volatility`, `atr_ratio`
    - **å¸‚å ´ç’°å¢ƒ**: `market_trend`
- **æ±ºç­–é–¾å€¼**: Probability â‰¥ 0.4
- **ç¸¾æ•ˆ**:
    - ROC AUC: ~0.73
    - æº–ç¢ºç‡: ~78% (åœ¨ 0.4 é–¾å€¼ä¸‹)

---

## ğŸ“Š ä½¿ç”¨æ–¹å¼

### 1. è‡ªå‹•åŒ–é‹è¡Œ (æ¨è–¦)
è«‹åƒè€ƒ [`CRONTAB_SETUP.md`](CRONTAB_SETUP.md) è¨­å®šæ¯æ—¥è‡ªå‹•æ’ç¨‹ã€‚

### 2. æ‰‹å‹•é‹è¡Œ

**æ¯æ—¥æƒæ**:
```bash
python stock/ml_enhanced/daily_ml_scanner.py
```

**é‡æ–°è¨“ç·´æ¨¡å‹**:
```bash
python stock/ml_enhanced/weekly_retrain.py
```

---

## âš ï¸ æ³¨æ„äº‹é …

1. **ä¾è³´é—œä¿‚**: ML ç³»çµ±ä¾è³´åŸå§‹ç³»çµ±çš„æ•¸æ“šæ›´æ–° (`scripts/update_daily_data.py`)ã€‚å‹™å¿…ç¢ºä¿åŸå§‹æ•¸æ“šæ˜¯æœ€æ–°çš„ã€‚
2. **æ¨¡å‹æª”æ¡ˆ**: `models/` ç›®éŒ„ä¸‹çš„ `.pkl` æª”æ¡ˆæ˜¯è‡ªå‹•ç”Ÿæˆçš„ï¼Œè«‹å‹¿æ‰‹å‹•ä¿®æ”¹ã€‚
3. **å›æ»¾**: å¦‚æœ ML ç³»çµ±å‡ºç¾å•é¡Œï¼ŒåŸå§‹çš„ `main.py` æƒæå®Œå…¨ç¨ç«‹ï¼Œä¸å—å½±éŸ¿ï¼Œå¯éš¨æ™‚åˆ‡å›åŸå§‹å ±å‘Šã€‚
