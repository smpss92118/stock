# 專案任務與流程

本檔案詳細記錄了「台灣股市資料爬蟲」專案的開發流程與各階段任務。

## 任務一：專案初始化與環境設定

此階段的目標是建立專案基礎，並使用 Poetry 管理 Python 環境。

- **子任務 1.1：初始化 Poetry 專案**
  - **動作**: 執行 `poetry init` 指令。
  - **產出**: 建立 `pyproject.toml` 檔案，定義專案元數據。

- **子任務 1.2：安裝核心相依套件**
  - **動作**: 使用 `poetry add` 指令安裝以下套件：
    - `twstock`: 用於獲取台灣股市資料。
    - `pandas`: 用於資料處理與分析。
    - `sqlalchemy`: 用於資料庫操作的 ORM。
    - `mysql-connector-python`: MySQL 的 Python 驅動程式。
  - **產出**: `pyproject.toml` 和 `poetry.lock` 檔案更新，包含新的相依套件。

- **子任務 1.3：處理隱藏的相依性**
  - **背景**: 在測試 `twstock` 時發現其依賴 `lxml` 套件，但並未在套件的 `setup.py` 中聲明。
  - **動作**: 手動執行 `poetry add lxml` 來解決 `ModuleNotFoundError`。
  - **產出**: 專案環境穩定，`twstock` 可正常匯入。

## 任務二：應用程式核心邏輯開發

此階段專注於實現專案的核心功能：抓取資料與存入資料庫。

- **子任務 2.1：開發資料抓取模組 (`fetcher.py`)**
  - **動作**:
    1.  研究 `twstock` 的 API，確定使用 `Stock` class 的 `fetch_from` 方法。
    2.  編寫 `fetch_all_stock_data` 函式，該函式能遍歷所有台股代碼，並抓取過去五年的歷史資料。
    3.  將抓取到的原始資料轉換為 Pandas DataFrame 以便後續處理。
  - **產出**: `stock_crawler/fetcher.py` 檔案。

- **子任務 2.2：開發資料庫互動模組 (`database.py`)**
  - **動作**:
    1.  編寫 `get_db_engine` 函式，使用 SQLAlchemy 建立與 MySQL 的連線引擎。
    2.  編寫 `save_data_to_db` 函式，使用 Pandas 的 `to_sql` 方法將 DataFrame 高效地寫入資料庫。設定 `if_exists='replace'` 以便每次執行都是最新的資料。
  - **產出**: `stock_crawler/database.py` 檔案。

- **子任務 2.3：建立主程式 (`main.py`)**
  - **動作**:
    1.  整合 `fetcher` 和 `database` 模組。
    2.  讀取設定檔 `config.ini` 來獲取資料庫連線資訊。
    3.  建立主流程：抓取資料 -> 連接資料庫 -> 儲存資料。
  - **產出**: `main.py` 檔案，作為專案的執行入口。

## 任務三：設定與文件化

此階段的目標是讓專案易於使用與理解。

- **子任務 3.1：建立設定檔 (`config.ini`)**
  - **動作**: 建立一個範本設定檔，包含資料庫連線所需的所有欄位（`host`, `user`, `password`, `database`），並使用預留位置值。
  - **目的**: 將敏感資訊與程式碼分離。
  - **產出**: `config.ini` 檔案。

- **子任務 3.2：撰寫詳細的 README.md**
  - **動作**: 建立一份全面的 `README.md` 文件，包含：
    - 專案介紹。
    - 環境需求（包含 Python, Poetry, MySQL 的安裝指引）。
    - 詳細的安裝與設定步驟（包含如何建立資料庫與使用者）。
    - 執行指令。
    - 潛在問題的說明（如網路超時）。
  - **產出**: `README.md` 檔案。

## 任務四：測試與提交

- **子任務 4.1：功能驗證**
  - **動作**: 嘗試在本機環境執行 `fetcher.py` 來驗證資料抓取功能。
  - **發現**: 執行時間過長，導致環境超時。即使將抓取目標縮小至 5 支股票甚至 1 支股票，問題依舊存在。

- **子任務 4.2：問題診斷與處理**
  - **分析**: 超時問題很可能源於執行環境的網路限制，而非程式碼本身錯誤。
  - **處理**:
    1.  將 `fetcher.py` 的程式碼恢復至最終的、完整的版本。
    2.  在 `README.md` 和提交訊息中註明此潛在問題。

- **子任務 4.3：提交程式碼**
  - **動作**: 使用 `submit` 工具提交所有程式碼。
  - **產出**: 一個包含完整功能與文件的 Git commit。
