# ç­–ç•¥è¶…åƒæ•¸å„ªåŒ–æŒ‡å—

## æ¦‚è¿°

æœ¬æ–‡æª”æ•´ç†äº† CUPã€HTFã€VCP ä¸‰ç¨®å‹æ…‹è­˜åˆ¥ç­–ç•¥çš„æ‰€æœ‰å¯èª¿æ•´è¶…åƒæ•¸ï¼Œä¸¦æä¾›åŸºæ–¼æŠ€è¡“åˆ†æç†è«–çš„å„ªåŒ–å»ºè­°ã€‚

---

## ä¸€ã€CUP (æ¯æŸ„å‹æ…‹) è¶…åƒæ•¸

### ç•¶å‰åƒæ•¸ (`src/strategies/cup.py`)

| åƒæ•¸åç¨± | ç•¶å‰å€¼ | ä½ç½® | èªªæ˜ |
|---------|--------|------|------|
| `min_depth` | 0.12 | L7 | æ¯åº•æ·±åº¦æœ€å°å€¼ï¼ˆ12%ï¼‰|
| `max_depth` | 0.33 | L8 | æ¯åº•æ·±åº¦æœ€å¤§å€¼ï¼ˆ33%ï¼‰|
| `handle_max_depth` | 0.15 | L9 | æ‰‹æŸ„æ·±åº¦æœ€å¤§å€¼ï¼ˆ15%ï¼‰|
| `rs_rating_threshold` | 0.0 | L19 | RS Rating é–€æª» |
| `min_window` | 40 | L16 | æœ€å°è³‡æ–™å¤©æ•¸ |
| `handle_length_ratio` | 0.2 | L65 | æ‰‹æŸ„é•·åº¦ä½”æ¯”ï¼ˆ20%ï¼‰|
| `min_handle_low_ratio` | 0.5 | L73 | æ‰‹æŸ„ä½é»ä½ç½®ï¼ˆæ¯åº•+50%æ·±åº¦ï¼‰|
| `price_vs_low52` | 1.25 | L36 | åƒ¹æ ¼éœ€ > 52é€±ä½é» Ã— 1.25 |
| `min_handle_days` | 10 | L62 | æ‰‹æŸ„æœ€å°å¤©æ•¸ |

### å„ªåŒ–å»ºè­°

#### ğŸ”¥ é«˜å„ªå…ˆç´šï¼ˆç›´æ¥å½±éŸ¿å‹ç‡ï¼‰

1. **æ¯åº•æ·±åº¦ç¯„åœ** `min_depth` / `max_depth`
   - **ç•¶å‰**: 12% - 33%
   - **å»ºè­°ç¯„åœ**: 
     - `min_depth`: 0.08 - 0.15 (æ­¥é•· 0.01)
     - `max_depth`: 0.25 - 0.40 (æ­¥é•· 0.05)
   - **ç†ç”±**: 
     - å¤ªæ·ºï¼ˆ<10%ï¼‰çš„æ¯å¯èƒ½æ˜¯å‡çªç ´
     - å¤ªæ·±ï¼ˆ>35%ï¼‰å¯èƒ½æ˜¯å¼±å‹¢è‚¡
     - William O'Neil å»ºè­° 12-33%ï¼Œä½†å¯æ¸¬è©¦æ›´å¯¬ç¯„åœ

2. **RS Rating é–€æª»** `rs_rating_threshold`
   - **ç•¶å‰**: 0
   - **å»ºè­°ç¯„åœ**: 0, 50, 70, 80, 90
   - **ç†ç”±**: 
     - RS > 70 æ˜¯å¼·å‹¢è‚¡æ¨™æº–
     - RS > 80 æ˜¯ O'Neil å»ºè­°çš„è²·é»
     - å¯æ¸¬è©¦ä¸åŒé–€æª»å°å‹ç‡çš„å½±éŸ¿

3. **æ‰‹æŸ„æ·±åº¦** `handle_max_depth`
   - **ç•¶å‰**: 15%
   - **å»ºè­°ç¯„åœ**: 0.10 - 0.20 (æ­¥é•· 0.05)
   - **ç†ç”±**: 
     - æ‰‹æŸ„å›èª¿å¤ªæ·±å¯èƒ½å¤±å»å‹•èƒ½
     - 10-15% æ˜¯ç†æƒ³ç¯„åœ

#### â­ ä¸­å„ªå…ˆç´šï¼ˆå½±éŸ¿è¨Šè™Ÿæ•¸é‡ï¼‰

4. **æ‰‹æŸ„é•·åº¦æ¯”ä¾‹** `handle_length_ratio`
   - **ç•¶å‰**: 0.2 (window çš„ 20%)
   - **å»ºè­°ç¯„åœ**: 0.15, 0.20, 0.25
   - **ç†ç”±**: å½±éŸ¿æ‰‹æŸ„è­˜åˆ¥æº–ç¢ºåº¦

5. **åƒ¹æ ¼ vs 52é€±ä½é»** `price_vs_low52`
   - **ç•¶å‰**: 1.25
   - **å»ºè­°ç¯„åœ**: 1.25, 1.35, 1.45
   - **ç†ç”±**: Minervini çš„è¶¨å‹¢æ¨¡æ¿è¦æ±‚

#### ğŸ’¡ ä½å„ªå…ˆç´šï¼ˆå¾®èª¿ï¼‰

6. **æœ€å°çª—å£å¤©æ•¸** `min_window`
   - **ç•¶å‰**: 40
   - **å»ºè­°**: ä¿æŒ 40-50ï¼Œä¸å»ºè­°èª¿æ•´

---

## äºŒã€HTF (é«˜çª„æ——å½¢) è¶…åƒæ•¸

### ç•¶å‰åƒæ•¸ (`src/strategies/htf.py`)

| åƒæ•¸åç¨± | ç•¶å‰å€¼ | ä½ç½® | èªªæ˜ |
|---------|--------|------|------|
| `min_up_ratio` | 0.8 | L6 | ä¸Šæ¼²å¹…åº¦æœ€å°å€¼ï¼ˆ80%ï¼‰|
| `max_pullback` | 0.25 | L7 | å›èª¿æœ€å¤§å€¼ï¼ˆ25%ï¼‰|
| `min_flag_days` | 3 | L8 | æ——å½¢æœ€å°å¤©æ•¸ |
| `max_flag_days` | 12 | L9 | æ——å½¢æœ€å¤§å¤©æ•¸ |
| `rs_rating_threshold` | 0.0 | L21 | RS Rating é–€æª» |
| `min_window` | 20 | L17 | æœ€å°è³‡æ–™å¤©æ•¸ |
| **Grade A æ¢ä»¶** | - | L71-73 | Pole>90%, Pullback<15%, Vol_drop>50% |
| **Grade B æ¢ä»¶** | - | L74-75 | Pole>90%, 15%â‰¤Pullback<20% |
| **Grade C æ¢ä»¶** | - | L76 | 20%â‰¤Pullbackâ‰¤25% |

### å„ªåŒ–å»ºè­°

#### ğŸ”¥ é«˜å„ªå…ˆç´š

1. **ä¸Šæ¼²å¹…åº¦è¦æ±‚** `min_up_ratio`
   - **ç•¶å‰**: 0.80ï¼ˆç¾è¡Œç¨‹å¼é è¨­ï¼›å„ªåŒ–å¯¦é©—æ›¾æ”¾å¯¬è‡³ 0.60ï¼‰
   - **å»ºè­°ç¯„åœ**: 0.60, 0.80, 1.00, 1.20
   - **ç†ç”±**: 
     - **é—œéµåƒæ•¸**ï¼å½±éŸ¿æœ€å¤§
     - 0.60 æ˜¯è¼ƒå¯¬é¬†çš„å„ªåŒ–é¸é …ï¼Œéœ€æ­é…å›æ¸¬ç¢ºèª
     - æ¸¬è©¦ä¸åŒä¸Šæ¼²å¹…åº¦å° R å€æ•¸çš„å½±éŸ¿

2. **å›èª¿æœ€å¤§å€¼** `max_pullback`
   - **ç•¶å‰**: 25%
   - **å»ºè­°ç¯„åœ**: 0.15, 0.20, 0.25, 0.30
   - **ç†ç”±**: 
     - å›èª¿è¶Šå°ï¼Œå‹•èƒ½è¶Šå¼·
     - ä½†é™åˆ¶å¤ªåš´æœƒæ¸›å°‘è¨Šè™Ÿ

3. **RS Rating é–€æª»**
   - **ç•¶å‰**: 0
   - **å»ºè­°ç¯„åœ**: 0, 70, 80, 90
   - **ç†ç”±**: HTF æ˜¯å¼·å‹¢å‹æ…‹ï¼Œæ‡‰é…åˆé«˜ RS

#### â­ ä¸­å„ªå…ˆç´š

4. **æ——å½¢å¤©æ•¸ç¯„åœ** `min_flag_days` / `max_flag_days`
   - **ç•¶å‰**: 3-12 å¤©
   - **å»ºè­°ç¯„åœ**: 
     - `min`: 2, 3, 5
     - `max`: 10, 12, 15
   - **ç†ç”±**: 
     - å¤ªçŸ­å¯èƒ½æ˜¯å‡æ——å½¢
     - å¤ªé•·å‹•èƒ½å¯èƒ½æµå¤±

5. **Grade é–€æª»å„ªåŒ–**
   - **Grade A pole**: 0.80, 0.90, 1.00
   - **Grade A pullback**: 0.12, 0.15, 0.18
   - **Grade A vol_drop**: 0.40, 0.50, 0.60
   - **ç†ç”±**: èª¿æ•´åˆ†ç´šæ¨™æº–ä»¥å„ªåŒ–ä¸åŒ Grade çš„è¡¨ç¾

---

## ä¸‰ã€VCP (æ³¢å‹•æ”¶ç¸®) è¶…åƒæ•¸

### ç•¶å‰åƒæ•¸ (`src/strategies/vcp.py`)

| åƒæ•¸åç¨± | ç•¶å‰å€¼ | ä½ç½® | èªªæ˜ |
|---------|--------|------|------|
| `zigzag_threshold` | 0.07 | L10 | ZigZag è½‰æŠ˜é–¾å€¼ï¼ˆ7%ï¼Œå·²å„ªåŒ–ï¼‰|
| `min_up_ratio` | 0.5 | L11 | ä¸Šæ¼²å¹…åº¦æœ€å°å€¼ï¼ˆ50%ï¼‰|
| `vol_dry_up_ratio` | 0.45 | L12 | æˆäº¤é‡ä¹¾æ¶¸æ¯”ä¾‹ï¼ˆ45%ï¼Œå·²å„ªåŒ–ï¼‰|
| `rs_rating_threshold` | 0.0 | L24 | RS Rating é–€æª» |
| `min_window` | 50 | L20 | æœ€å°è³‡æ–™å¤©æ•¸ |
| `min_window_high_idx` | 10 | L36 | è¦–çª—å…§æœ€é«˜é»æœ€å°ä½ç½®ï¼ˆæ—¥æ•¸ï¼‰|
| `pivot_proximity` | 0.95 | L96 | åƒ¹æ ¼æ¥è¿‘è½‰æŠ˜é»æ¯”ä¾‹ï¼ˆ95%ï¼‰|
| `min_contractions` | 2 | L58 | æœ€å°æ”¶ç¸®æ³¢æ¬¡æ•¸ |
| `recent_vol_window` | 5 | L69 | è¿‘æœŸæˆäº¤é‡è¨ˆç®—çª—å£ï¼ˆæ—¥æ•¸ï¼‰|

### å„ªåŒ–å»ºè­°

#### ğŸ”¥ é«˜å„ªå…ˆç´š

1. **ZigZag é–¾å€¼** `zigzag_threshold`
   - **ç•¶å‰**: 5%
   - **å»ºè­°ç¯„åœ**: 0.03, 0.05, 0.08, 0.10
   - **ç†ç”±**: 
     - **æœ€é—œéµåƒæ•¸**ï¼æ±ºå®šè½‰æŠ˜é»è­˜åˆ¥
     - å¤ªå°æœƒç”¢ç”Ÿå™ªéŸ³è½‰æŠ˜
     - å¤ªå¤§æœƒéŒ¯éçœŸå¯¦è½‰æŠ˜

2. **ä¸Šæ¼²å¹…åº¦è¦æ±‚** `min_up_ratio`
   - **ç•¶å‰**: 50%
   - **å»ºè­°ç¯„åœ**: 0.40, 0.50, 0.60, 0.80
   - **ç†ç”±**: 
     - VCP é€šå¸¸å‡ºç¾åœ¨å·²ä¸Šæ¼²çš„è‚¡ç¥¨
     - æ¸¬è©¦ä¸åŒå¹…åº¦çš„å‹ç‡å·®ç•°

3. **RS Rating é–€æª»**
   - **ç•¶å‰**: 0
   - **å»ºè­°ç¯„åœ**: 0, 50, 70, 80
   - **ç†ç”±**: VCP æ‡‰è©²æ˜¯ç›¸å°å¼·å‹¢è‚¡

#### â­ ä¸­å„ªå…ˆç´š

4. **æˆäº¤é‡ä¹¾æ¶¸æ¯”ä¾‹** `vol_dry_up_ratio`
   - **ç•¶å‰**: 50% (recent vol < 50% of MA50)
   - **å»ºè­°ç¯„åœ**: 0.40, 0.50, 0.60, 0.70
   - **ç†ç”±**: 
     - æˆäº¤é‡ä¹¾æ¶¸æ˜¯ VCP é—œéµç‰¹å¾µ
     - å¤ªåš´æ ¼æœƒæ¸›å°‘è¨Šè™Ÿ

5. **åƒ¹æ ¼æ¥è¿‘è½‰æŠ˜é»** `pivot_proximity`
   - **ç•¶å‰**: 95% (åƒ¹æ ¼éœ€ > pivot Ã— 0.95)
   - **å»ºè­°ç¯„åœ**: 0.90, 0.95, 0.98
   - **ç†ç”±**: 
     - æ§åˆ¶è²·é»æ™‚æ©Ÿ
     - å¤ªå¯¬é¬†æœƒææ—©è²·å…¥

#### ğŸ’¡ ä½å„ªå…ˆç´š

6. **æœ€å°æ”¶ç¸®æ¬¡æ•¸** `min_contractions`
   - **ç•¶å‰**: 2
   - **å»ºè­°**: 2, 3 ,4

---

## å››ã€å„ªåŒ–ç­–ç•¥èˆ‡åŸ·è¡Œé †åº

### éšæ®µ 1ï¼šå–®ä¸€ç­–ç•¥æ ¸å¿ƒåƒæ•¸å„ªåŒ– (First Pass)

**ç›®æ¨™**: æ‰¾åˆ°æ¯å€‹ç­–ç•¥çš„æœ€ä½³å–®ä¸€åƒæ•¸é…ç½®

#### Step 1.1: CUP æ ¸å¿ƒå„ªåŒ–
```python
# å„ªå…ˆç´šé †åº
1. rs_rating_threshold: [0, 70, 80, 90]
2. min_depth: [0.10, 0.12, 0.15]
3. max_depth: [0.28, 0.33, 0.38]
4. handle_max_depth: [0.10, 0.15, 0.20]

# çµ„åˆæ•¸: 4 Ã— 3 Ã— 3 Ã— 3 = 108 çµ„
# é ä¼°æ™‚é–“: ~2 å°æ™‚
```

#### Step 1.2: HTF æ ¸å¿ƒå„ªåŒ–
```python
1. min_up_ratio: [0.50, 0.60, 0.80]
2. max_pullback: [0.15, 0.20, 0.25]
3. rs_rating_threshold: [0, 70, 80]

# çµ„åˆæ•¸: 3 Ã— 3 Ã— 3 = 27 çµ„
# é ä¼°æ™‚é–“: ~30 åˆ†é˜
```

#### Step 1.3: VCP æ ¸å¿ƒå„ªåŒ–
```python
1. zigzag_threshold: [0.04, 0.05, 0.07]
2. min_up_ratio: [0.40, 0.50, 0.60]
3. vol_dry_up_ratio: [0.45, 0.50, 0.60]

# çµ„åˆæ•¸: 3 Ã— 3 Ã— 3 = 27 çµ„
# é ä¼°æ™‚é–“: ~30 åˆ†é˜
```

### éšæ®µ 2ï¼šç´°éƒ¨åƒæ•¸å¾®èª¿ (Fine-tuning)

**ç›®æ¨™**: åœ¨æœ€ä½³æ ¸å¿ƒåƒæ•¸åŸºç¤ä¸Šå¾®èª¿æ¬¡è¦åƒæ•¸

#### Step 2.1: åŸºæ–¼ Stage 1 æœ€ä½³çµæœ
- å›ºå®šæ ¸å¿ƒåƒæ•¸ç‚º Stage 1 çš„æœ€å„ªè§£
- å¾®èª¿æ¬¡è¦åƒæ•¸ï¼ˆæ——å½¢å¤©æ•¸ã€æ‰‹æŸ„é•·åº¦ç­‰ï¼‰

#### Step 2.2: Grade/åˆ†ç´šå„ªåŒ– (HTF)
```python
# åŸºæ–¼ HTF æœ€ä½³æ ¸å¿ƒåƒæ•¸
Grade_A_conditions: 
  - pole: [0.85, 0.90, 1.00]
  - pullback: [0.12, 0.15, 0.18]
  - vol_drop: [0.45, 0.50, 0.55]
```

### éšæ®µ 3ï¼šçµ„åˆå„ªåŒ– (Portfolio)

**ç›®æ¨™**: å„ªåŒ–å¤šç­–ç•¥çµ„åˆæ¬Šé‡

```python
# æ¸¬è©¦ä¸åŒç­–ç•¥çµ„åˆ
1. CUP only
2. HTF only  
3. CUP + HTF
4. CUP + HTF + VCP
5. HTF Grade A only

# æ¯å€‹çµ„åˆæ¸¬è©¦ä¸åŒçš„ R å€æ•¸å‡ºå ´
```

---

## äº”ã€è©•ä¼°æŒ‡æ¨™

### ä¸»è¦æŒ‡æ¨™ (Primary Metrics)

1. **å¹´åŒ–å ±é…¬ç‡** (Annualized Return %)
   - æ¬Šé‡: 40%

2. **å¤æ™®æ¯”ç‡** (Sharpe Ratio)
   - æ¬Šé‡: 40%

3. **äº¤æ˜“æ¬¡æ•¸** (Win Rate)
   - æ¬Šé‡: 15%

4. **æœ€å¤§å›æ’¤** (Max Drawdown)
   - æ¬Šé‡: 5%

### æ¬¡è¦æŒ‡æ¨™ (Secondary Metrics)

- ç¸½äº¤æ˜“æ¬¡æ•¸ (é¿å…éåº¦äº¤æ˜“)
- å¹³å‡æŒå€‰å¤©æ•¸
- ç›ˆè™§æ¯” (Profit Factor)
- é€£çºŒè™§ææ¬¡æ•¸

---

## å…­ã€Grid Search é…ç½®å»ºè­°

### æ–¹æ³• 1: ç²—ç¶²æ ¼ â†’ ç´°ç¶²æ ¼ (æ¨è–¦)

```python
# Stage 1: Coarse Grid
step_1_config = {
    'CUP': {
        'rs_rating': [0, 80],
        'min_depth': [0.10, 0.15],
        'max_depth': [0.28, 0.38]
    }
}

# Stage 2: Fine Grid (åŸºæ–¼ Stage 1 æœ€ä½³å€¼ Â±1 step)
step_2_config = {
    'CUP': {
        'rs_rating': [best - 10, best, best + 10],
        'min_depth': [best - 0.02, best, best + 0.02],
        ...
    }
}
```

### æ–¹æ³• 2: Random Search (å‚™é¸)

```python
# å¦‚æœçµ„åˆæ•¸éå¤šï¼ˆ> 500ï¼‰ï¼Œä½¿ç”¨éš¨æ©Ÿæœç´¢
n_iterations = 200
sample_randomly(parameter_space)
```

---

## ä¸ƒã€å¯¦æ–½å»ºè­°

### æŠ€è¡“è€ƒé‡

1. **Parallel Processing**
   - ä½¿ç”¨å¤šé€²ç¨‹ä¸¦è¡Œæ¸¬è©¦ä¸åŒåƒæ•¸çµ„åˆ
   - é æœŸåŠ é€Ÿæ¯”: 8x (8 æ ¸å¿ƒ)

2. **Caching**
   - Cache pattern_analysis_result.csv é¿å…é‡è¤‡è¨ˆç®—
   - åªé‡æ–°è¨ˆç®— pattern detectionï¼Œä¸é‡ç®— MA/RS

3. **Early Stopping**
   - å¦‚æœåƒæ•¸çµ„åˆç”¢ç”Ÿ 0 è¨Šè™Ÿï¼Œç›´æ¥è·³é
   - å¦‚æœå¤æ™®æ¯”ç‡ < 0ï¼Œæå‰çµ‚æ­¢

### æ™‚é–“ä¼°ç®—

| éšæ®µ | çµ„åˆæ•¸ | é ä¼°æ™‚é–“ |
|-----|-------|---------|
| Stage 1.1 (CUP) | 108 | 2 å°æ™‚ |
| Stage 1.2 (HTF) | 27 | 30 åˆ†é˜ |
| Stage 1.3 (VCP) | 27 | 30 åˆ†é˜ |
| Stage 2 (Fine-tune) | 100 | 1 å°æ™‚ |
| **ç¸½è¨ˆ** | **262** | **4 å°æ™‚** |

---

## å…«ã€æ³¨æ„äº‹é …èˆ‡é¢¨éšª

### âš ï¸ éåº¦æ“¬åˆ (Overfitting)

1. **ç—‡ç‹€**:
   - å›æ¸¬è¡¨ç¾å„ªç•°ï¼Œä½†å¯¦ç›¤è¡¨ç¾å·®
   - åƒæ•¸éæ–¼ç²¾ç¢ºï¼ˆå¦‚ 0.1234ï¼‰

2. **é é˜²**:
   - ä½¿ç”¨ Train/Test Split (70/30)
   - Walk-Forward Analysis
   - ä¿æŒåƒæ•¸åœ“æ•´ï¼ˆ0.15 è€Œé 0.1486ï¼‰

### âš ï¸ æ•¸æ“šçªºæ¢åå·® (Look-Ahead Bias)

- ç¢ºä¿æ‰€æœ‰æŒ‡æ¨™éƒ½æ˜¯ã€Œç•¶æ™‚å¯çŸ¥ã€çš„
- RS Rating è¨ˆç®—ä¸èƒ½ä½¿ç”¨æœªä¾†æ•¸æ“š

### âš ï¸ æ¨£æœ¬æ•¸ä¸è¶³

- å¦‚æœæŸåƒæ•¸çµ„åˆåªç”¢ç”Ÿ < 30 ç­†äº¤æ˜“
- çµ±è¨ˆæ„ç¾©ä¸è¶³ï¼Œéœ€è¬¹æ…è§£è®€

---

## ä¹ã€ä¸‹ä¸€æ­¥è¡Œå‹•

### ç«‹å³å¯åš

1. âœ… ç¢ºèªæ­¤åƒæ•¸åˆ—è¡¨æ˜¯å¦å®Œæ•´
2. âœ… æ±ºå®šå„ªåŒ–é †åºï¼ˆå»ºè­°å¾ HTF é–‹å§‹ï¼Œå› ç‚ºçµ„åˆæ•¸æœ€å°‘ï¼‰
3. â¬œ å»ºç«‹ Grid Search è…³æœ¬
4. â¬œ è¨­å®šè©•ä¼°æŒ‡æ¨™æ¬Šé‡
5. â¬œ åŸ·è¡Œ Stage 1.2 (HTF å„ªåŒ–)

### ä¸­æœŸè¦åŠƒ

- å»ºç«‹è‡ªå‹•åŒ–åƒæ•¸å„ªåŒ– pipeline
- è¦–è¦ºåŒ–åƒæ•¸ç©ºé–“ (Heatmap)
- è¨­å®šåƒæ•¸è®Šæ›´çš„ A/B Testing æµç¨‹

---

*æœ€å¾Œæ›´æ–°: 2025-11-20*
